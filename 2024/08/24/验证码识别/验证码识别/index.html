<!doctype html>
<html lang="zh"><head>
<title>360点选识别 - skuukzky</title>
<meta charset="UTF-8">
<meta name="keywords" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">

<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
<meta name="description" content="360 点选实战(yolvo8+孪生)过程我们使用 python 脚本 爬取保存大概 100 多张图片即可，放在本地文件夹下。接着使用X-AnyLabeling 进行数据标注。主要注意的是需要导出中转为 yolo 格式，这样的话可以自动转为 yolo 可识别的 txt 文件接下来我们打标就可，因为是做孪生，所以我们不需要详细分类，给每个标签打上固定的标签即可，我这里是 labels。 依次标注即可">
<meta property="og:type" content="article">
<meta property="og:title" content="360点选识别">
<meta property="og:url" content="https://lpy30m.github.io/skuukzky.github.io/2024/08/24/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/index.html">
<meta property="og:site_name" content="skuukzky">
<meta property="og:description" content="360 点选实战(yolvo8+孪生)过程我们使用 python 脚本 爬取保存大概 100 多张图片即可，放在本地文件夹下。接着使用X-AnyLabeling 进行数据标注。主要注意的是需要导出中转为 yolo 格式，这样的话可以自动转为 yolo 可识别的 txt 文件接下来我们打标就可，因为是做孪生，所以我们不需要详细分类，给每个标签打上固定的标签即可，我这里是 labels。 依次标注即可">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107346972-bf3dab65-1824-4b97-a157-eaa9ae463a78.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107076190-7adeff64-db76-48d4-8cbb-745b534cfb41.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107526321-54660c7e-6f80-4466-98b8-53de9ae7c807.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109309098-3d76ce04-5cdd-4b9b-9cfc-6c659a5b58ec.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109335692-96b94096-5360-4bcb-8dc2-1f3b53404403.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109405751-47dd734f-2a83-487a-9467-61aa33386913.png">
<meta property="article:published_time" content="2024-08-24T08:08:48.000Z">
<meta property="article:modified_time" content="2024-08-28T06:20:13.527Z">
<meta property="article:author" content="skuukzky">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107346972-bf3dab65-1824-4b97-a157-eaa9ae463a78.png">

<link rel="stylesheet" href="/skuukzky.github.io/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/skuukzky.github.io/lib/mdui_043tiny/mdui.css">


<link rel="stylesheet" href="/skuukzky.github.io/lib/iconfont/iconfont.css?v=1745648493405">

<link rel="stylesheet" href="/skuukzky.github.io/css/style.css?v=1745648493405">




    
        <link rel="stylesheet" href="/skuukzky.github.io/custom.css?v=1745648493405">
    



<script src="/skuukzky.github.io/lib/mdui_043tiny/mdui.js" async></script>
<script src="/skuukzky.github.io/lib/fancybox/fancybox.umd.js" async></script>
<script src="/skuukzky.github.io/lib/lax.min.js" async></script>


<script async src="/skuukzky.github.io/js/app.js?v=1745648493405"></script>

 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4D4ZJ9G024"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag("js", new Date());

  gtag("config", "G-4D4ZJ9G024");
</script>


<link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-shiki-plugin@latest/lib/codeblock.css">
<style>:root{--hl-color:#abb2bf;--hl-bg:#282c34;--hltools-bg:#21252b;--hltools-color:#bbbbbc;--hlnumber-bg:#282c34;--hlnumber-color:#495162;--hlscrollbar-bg:#373c47;--hlexpand-bg:linear-gradient(180deg,rgba(40,44,52,0.1),rgba(40,44,52,0.9))}</style>
    <style>
    .code-expand-btn:not(.expand-done) ~ div.codeblock,
    .code-expand-btn:not(.expand-done) ~ * div.codeblock {
      overflow: hidden;
      height: 360px;
    }
    </style>
  <!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body class="nexmoe mdui-drawer-body-left"><div id="nexmoe-background"><div class="nexmoe-bg" style="background-image: url(https://image.3001.net/images/20250307/1741314829_67ca5b0d4957ea5241ba3.png)"></div><div class="mdui-appbar mdui-shadow-0"><div class="mdui-toolbar"><a class="mdui-btn mdui-btn-icon mdui-ripple" mdui-drawer="{target: &#039;#drawer&#039;, swipe: true}" title="menu"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class="mdui-toolbar-spacer"></div><a class="mdui-btn mdui-btn-icon" href="/skuukzky.github.io/" title="skuukzky"><img src="https://image.3001.net/images/20250307/1741314773_67ca5ad59320935fabc37.png" alt="skuukzky"></a></div></div></div><div id="nexmoe-header"><div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/skuukzky.github.io/" title="skuukzky">
            <img src="https://image.3001.net/images/20250307/1741314773_67ca5ad59320935fabc37.png" alt="skuukzky" alt="skuukzky">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>12</div>
        <div><span>标签</span>0</div>
        <div><span>分类</span>2</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/skuukzky.github.io/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/skuukzky.github.io/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/skuukzky.github.io/PY.html" title="我的朋友">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的朋友
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/skuukzky.github.io/donate.html" title="给我赞助">
            <i class="mdui-list-item-icon nexmoefont icon-coffee"></i>
            <div class="mdui-list-item-content">
                给我赞助
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/skuukzky.github.io/about.html" title="关于博主">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博主
            </div>
        </a>
        
    </div>
    
    
        
        <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
         
            <form id="search_form" action_e="https://cn.bing.com/search?q=site:nexmoe.com" onsubmit="return search();">
                <label><input id="search_value" name="q" type="search" placeholder="搜索"></label>
            </form>
         
    </div>
</div>




    
        
        <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://space.bilibili.com/603975910"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://github.com/lpy30m/"
			target="_blank"
			mdui-tooltip="{content: 'GitHub'}"
			style="
				color: rgb(25, 23, 23);
				background-color: rgba(25, 23, 23, .1);
			"
		>
			<i
				class="nexmoefont icon-github"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://nexmoe.com/atom.xml"
			target="_blank"
			mdui-tooltip="{content: 'RSS'}"
			style="
				color: rgb(247, 132, 34);
				background-color: rgba(247, 132, 34, .1);
			"
		>
			<i
				class="nexmoefont icon-rss"
			></i> </a
		>
	</div>
</div>

    
        
        
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/skuukzky.github.io/categories/逆向/">逆向</a>
          <span class="category-list-count">8</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/skuukzky.github.io/categories/验证码识别/">验证码识别</a>
          <span class="category-list-count">3</span>
        </li>

        
      </ul>

    </div>
  </div>


    
        
        
    
        
        
        
        
   
    <div class="nexmoe-copyright">
        &copy; 2025 skuukzky
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        <br><a target="_blank" href="https://beian.miit.gov.cn/"></a>

    </div>
</div><!-- .nexmoe-drawer --></div><div id="nexmoe-content"><div class="nexmoe-primary"><div class="nexmoe-post">
  <article>
    
        <div class="nexmoe-post-cover absolute" style="padding-top: 33.33333333333333%;"> 
            <img src="https://api.dujin.org/bing/1366.php" alt="360点选识别" loading="lazy">
            <h1>360点选识别</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2024年08月24日</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/skuukzky.github.io/categories/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/">验证码识别</a>
        
        
    </div>
    
    
    
    
    
</div>

    <h3 id="360-点选实战-yolvo8-孪生"><a href="#360-点选实战-yolvo8-孪生" class="headerlink" title="360 点选实战(yolvo8+孪生)"></a><a target="_blank" rel="noopener" href="https://sqhd.u.360.cn/jszt/captcha.html">360 点选</a>实战(yolvo8+孪生)</h3><h4 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h4><p>我们使用 python 脚本 爬取保存大概 100 多张图片即可，放在本地文件夹下。<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107346972-bf3dab65-1824-4b97-a157-eaa9ae463a78.png" alt="image.png" data-caption="image.png" loading="lazy"><br>接着使用<a target="_blank" rel="noopener" href="https://github.com/CVHub520/X-AnyLabeling/">X-AnyLabeling</a> 进行数据标注。<br>主要注意的是需要导出中转为 yolo 格式，这样的话可以自动转为 yolo 可识别的 txt 文件<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107076190-7adeff64-db76-48d4-8cbb-745b534cfb41.png" alt="image.png" data-caption="image.png" loading="lazy"><br>接下来我们打标就可，因为是做孪生，所以我们不需要详细分类，给每个标签打上固定的标签即可，我这里是 labels。 依次标注即可，360 这个并没有太多的图片，基本都是相同种类重复的偏多，就是改个字体。<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723107526321-54660c7e-6f80-4466-98b8-53de9ae7c807.png" alt="image.png" data-caption="image.png" loading="lazy"><br>打完标之后我们就可以利用一个脚本 进行格式转化了</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #7F848E; font-style: italic"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> json</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> os</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> random</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> shutil</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">json2yolo</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">json_folder</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">class_dic</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;&quot;&quot;讲labelme的json文件转成txt文件  {&quot;notch&quot;: &#39;0&#39;}&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    file_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(json_folder)</span></span>
<span class="line"><span style="color: #ABB2BF">    txt_folder </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">dirname</span><span style="color: #ABB2BF">(json_folder) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;\labels_txt&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">(txt_folder):</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">makedirs</span><span style="color: #ABB2BF">(txt_folder)</span></span>
<span class="line"><span style="color: #ABB2BF">    json_file_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [x </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> x </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> file_list </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;.json&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> x]  </span><span style="color: #7F848E; font-style: italic"># 获取所有json文件的路径</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> p </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> json_file_list:</span></span>
<span class="line"><span style="color: #ABB2BF">        json_file </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(json_folder, p)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(json_file, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;utf-8&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> f:</span></span>
<span class="line"><span style="color: #ABB2BF">            data </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> json.</span><span style="color: #61AFEF">loads</span><span style="color: #ABB2BF">(f.</span><span style="color: #61AFEF">read</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        img_w </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> data[</span><span style="color: #98C379">&quot;imageWidth&quot;</span><span style="color: #ABB2BF">]  </span><span style="color: #7F848E; font-style: italic"># 获取json文件里图片的宽高</span></span>
<span class="line"><span style="color: #ABB2BF">        img_h </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> data[</span><span style="color: #98C379">&quot;imageHeight&quot;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">        all_line </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> data[</span><span style="color: #98C379">&quot;shapes&quot;</span><span style="color: #ABB2BF">]:</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># 归一化坐标点。并得到cx,cy,w,h</span></span>
<span class="line"><span style="color: #ABB2BF">            [[x1, y1], [x2, y2]] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> i[</span><span style="color: #98C379">&#39;points&#39;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">            x1, x2 </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> x1 </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> img_w, x2 </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> img_w</span></span>
<span class="line"><span style="color: #ABB2BF">            y1, y2 </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> y1 </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> img_h, y2 </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> img_h</span></span>
<span class="line"><span style="color: #ABB2BF">            cx </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (x1 </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> x2) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span></span>
<span class="line"><span style="color: #ABB2BF">            cy </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> (y1 </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> y2) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span></span>
<span class="line"><span style="color: #ABB2BF">            w </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">abs</span><span style="color: #ABB2BF">(x2 </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> x1)</span></span>
<span class="line"><span style="color: #ABB2BF">            h </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">abs</span><span style="color: #ABB2BF">(y2 </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> y1)</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># 将数据组装成yolo格式</span></span>
<span class="line"><span style="color: #ABB2BF">            line </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;%s %.4f %.4f %.4f %.4f</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">%</span><span style="color: #ABB2BF"> (class_dic[i[</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">]], cx, cy, w, h)  </span><span style="color: #7F848E; font-style: italic"># 生成txt文件里每行的内容</span></span>
<span class="line"><span style="color: #ABB2BF">            all_line </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> line</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic"># print(all_line)</span></span>
<span class="line"><span style="color: #ABB2BF">        txt_file </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(txt_folder, p.</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;json&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;txt&#39;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(txt_file, </span><span style="color: #98C379">&#39;w&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;utf-8&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> fh:</span></span>
<span class="line"><span style="color: #ABB2BF">            fh.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(all_line)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># json2yolo(r&#39;D:\Web_Decryption\SEASON\0527\test&#39;, {&quot;殊&quot;:&quot;0&quot;,&quot;乡&quot;:&quot;1&quot;,&quot;趋&quot;:&quot;2&quot;,})</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">shape2id</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">json_folder</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    classes2id </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {}</span></span>
<span class="line"><span style="color: #ABB2BF">    classes_all </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">set</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span>
<span class="line"><span style="color: #ABB2BF">    jsons </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(json_folder)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> jsons:</span></span>
<span class="line"><span style="color: #ABB2BF">        json_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(json_folder, i)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(json_path, </span><span style="color: #98C379">&#39;r&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;utf-8&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> f:</span></span>
<span class="line"><span style="color: #ABB2BF">            json_data </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> json.</span><span style="color: #61AFEF">load</span><span style="color: #ABB2BF">(f)</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># print(json_data[&#39;shapes&#39;])</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> j </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> json_data[</span><span style="color: #98C379">&#39;shapes&#39;</span><span style="color: #ABB2BF">]:</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> j[</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> classes2id:</span></span>
<span class="line"><span style="color: #ABB2BF">                    classes2id[j[</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">]] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> num</span></span>
<span class="line"><span style="color: #ABB2BF">                    num </span><span style="color: #56B6C2">+=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1</span></span>
<span class="line"><span style="color: #ABB2BF">                    classes_all.</span><span style="color: #61AFEF">add</span><span style="color: #ABB2BF">(j[</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">])</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(classes2id)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;所有分类&quot;</span><span style="color: #ABB2BF">, classes_all)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> classes2id</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># shape2id(r&#39;D:\day_soft\Labelme\custom_model\lably&#39;)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">split_images_floder</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">img_dir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">label_dir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">img_suffix</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&#39;.png&#39;</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #98C379">    将数据集划分为训练集，验证集，测试集</span></span>
<span class="line"><span style="color: #98C379">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 1.确定原图片数据集路径</span></span>
<span class="line"><span style="color: #ABB2BF">    datasetimg_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> img_dir</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 确定原label数据集路径</span></span>
<span class="line"><span style="color: #ABB2BF">    datasetlabel_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> label_dir</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 2.确定数据集划分后保存的路径</span></span>
<span class="line"><span style="color: #ABB2BF">    _f </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">dirname</span><span style="color: #ABB2BF">(img_dir)</span></span>
<span class="line"><span style="color: #ABB2BF">    split_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(_f, </span><span style="color: #98C379">&quot;dataset&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    train_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(split_dir, </span><span style="color: #98C379">&quot;train&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    valid_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(split_dir, </span><span style="color: #98C379">&quot;valid&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    test_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(split_dir, </span><span style="color: #98C379">&quot;test&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    dir_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [train_dir, valid_dir, test_dir]</span></span>
<span class="line"><span style="color: #ABB2BF">    image_label </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">&#39;images&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;labels&#39;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">range</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(dir_list)):</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> j </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">range</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(image_label)):</span></span>
<span class="line"><span style="color: #ABB2BF">            new_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(dir_list[i], image_label[j])</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">(new_dir):</span></span>
<span class="line"><span style="color: #ABB2BF">                os.</span><span style="color: #61AFEF">makedirs</span><span style="color: #ABB2BF">(new_dir)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 3.确定将数据集划分为训练集，验证集，测试集的比例</span></span>
<span class="line"><span style="color: #ABB2BF">    train_pct </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.9</span></span>
<span class="line"><span style="color: #ABB2BF">    valid_pct </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.1</span></span>
<span class="line"><span style="color: #ABB2BF">    test_pct </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 4.划分</span></span>
<span class="line"><span style="color: #ABB2BF">    imgs </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(datasetimg_dir)  </span><span style="color: #7F848E; font-style: italic"># 展示目标文件夹下所有的文件名</span></span>
<span class="line"><span style="color: #ABB2BF">    imgs </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">list</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">filter</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">lambda</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">x</span><span style="color: #ABB2BF">: x.</span><span style="color: #61AFEF">endswith</span><span style="color: #ABB2BF">(img_suffix), imgs))  </span><span style="color: #7F848E; font-style: italic"># 取到所有以.png结尾的文件，如果改了图片格式，这里需要修改</span></span>
<span class="line"><span style="color: #ABB2BF">    random.</span><span style="color: #61AFEF">shuffle</span><span style="color: #ABB2BF">(imgs)  </span><span style="color: #7F848E; font-style: italic"># 乱序路径</span></span>
<span class="line"><span style="color: #ABB2BF">    img_count </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(imgs)  </span><span style="color: #7F848E; font-style: italic"># 计算图片数量</span></span>
<span class="line"><span style="color: #ABB2BF">    train_point </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(img_count </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> train_pct)  </span><span style="color: #7F848E; font-style: italic"># 0:train_pct</span></span>
<span class="line"><span style="color: #ABB2BF">    valid_point </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(img_count </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> (train_pct </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> valid_pct))  </span><span style="color: #7F848E; font-style: italic"># train_pct:valid_pct</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> i </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">range</span><span style="color: #ABB2BF">(img_count):</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> train_point:  </span><span style="color: #7F848E; font-style: italic"># 保存0-train_point的图片到训练集</span></span>
<span class="line"><span style="color: #ABB2BF">            out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(train_dir, </span><span style="color: #98C379">&#39;images&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            label_out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(train_dir, </span><span style="color: #98C379">&#39;labels&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">elif</span><span style="color: #ABB2BF"> i </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> valid_point:  </span><span style="color: #7F848E; font-style: italic"># 保存train_point-valid_point的图片到验证集</span></span>
<span class="line"><span style="color: #ABB2BF">            out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(valid_dir, </span><span style="color: #98C379">&#39;images&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            label_out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(valid_dir, </span><span style="color: #98C379">&#39;labels&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">else</span><span style="color: #ABB2BF">:  </span><span style="color: #7F848E; font-style: italic"># 保存test_point-结束的图片到测试集</span></span>
<span class="line"><span style="color: #ABB2BF">            out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(test_dir, </span><span style="color: #98C379">&#39;images&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">            label_out_dir </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(test_dir, </span><span style="color: #98C379">&#39;labels&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        target_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(out_dir, imgs[i])  </span><span style="color: #7F848E; font-style: italic"># 指定目标保存路径</span></span>
<span class="line"><span style="color: #ABB2BF">        src_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(datasetimg_dir, imgs[i])  </span><span style="color: #7F848E; font-style: italic"># 指定目标原图像路径</span></span>
<span class="line"><span style="color: #ABB2BF">        label_target_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(label_out_dir, imgs[i][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">:</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;.txt&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        label_src_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(datasetlabel_dir, imgs[i][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">:</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">4</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;.txt&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        shutil.</span><span style="color: #61AFEF">copy</span><span style="color: #ABB2BF">(src_path, target_path)  </span><span style="color: #7F848E; font-style: italic"># 复制图片</span></span>
<span class="line"><span style="color: #ABB2BF">        shutil.</span><span style="color: #61AFEF">copy</span><span style="color: #ABB2BF">(label_src_path, label_target_path)  </span><span style="color: #7F848E; font-style: italic"># 复制txt</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;train:</span><span style="color: #D19A66">{}</span><span style="color: #98C379">, valid:</span><span style="color: #D19A66">{}</span><span style="color: #98C379">, test:</span><span style="color: #D19A66">{}</span><span style="color: #98C379">&#39;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">format</span><span style="color: #ABB2BF">(train_point, valid_point </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> train_point, img_count </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> valid_point))</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">#split_images_floder(r&quot;C:\Users\24572\PycharmProjects\pythonProject\360click\images&quot;, r&quot;C:\Users\24572\PycharmProjects\pythonProject\360click\labels&quot;)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">make_yolo_yaml</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">yaml_name</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">image_dir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">class_names</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;&quot;&quot;生成yolo格式的yaml文件&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">(yaml_name):</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">makedirs</span><span style="color: #ABB2BF">(yaml_name)</span></span>
<span class="line"><span style="color: #ABB2BF">    nums </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(class_names)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 生成数据集配置.yaml</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(yaml_name, </span><span style="color: #98C379">&quot;w&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;utf-8&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> f:</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;train: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">image_dir</span><span style="color: #D19A66">}</span><span style="color: #98C379">/train/images</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;val: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">image_dir</span><span style="color: #D19A66">}</span><span style="color: #98C379">/valid/images</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;test: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">image_dir</span><span style="color: #D19A66">}</span><span style="color: #98C379">/test/images</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;nc: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">nums</span><span style="color: #D19A66">}</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;names: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">class_names</span><span style="color: #D19A66">}</span><span style="color: #56B6C2">\n</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #61AFEF">make_yolo_yaml</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">r</span><span style="color: #E06C75">&quot;C:</span><span style="color: #56B6C2">\U</span><span style="color: #E06C75">sers</span><span style="color: #56B6C2">\245</span><span style="color: #E06C75">72</span><span style="color: #56B6C2">\P</span><span style="color: #E06C75">ycharmProjects</span><span style="color: #56B6C2">\p</span><span style="color: #E06C75">ythonProject</span><span style="color: #56B6C2">\360</span><span style="color: #E06C75">click</span><span style="color: #56B6C2">\f</span><span style="color: #E06C75">ont.yaml&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #C678DD">r</span><span style="color: #E06C75">&#39;C:</span><span style="color: #56B6C2">\U</span><span style="color: #E06C75">sers</span><span style="color: #56B6C2">\245</span><span style="color: #E06C75">72</span><span style="color: #56B6C2">\P</span><span style="color: #E06C75">ycharmProjects</span><span style="color: #56B6C2">\p</span><span style="color: #E06C75">ythonProject</span><span style="color: #56B6C2">\360</span><span style="color: #E06C75">click\dataset&#39;</span><span style="color: #ABB2BF">, [</span><span style="color: #98C379">&quot;labels&quot;</span><span style="color: #ABB2BF">])</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">create_valid_test_folder</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">image_dir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">labels_dir</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">img_suffix</span><span style="color: #ABB2BF">=</span><span style="color: #98C379">&#39;.jpg&#39;</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #98C379">    :param image_dir:  D:\Yzmtrain\yzmdata\dyclick_524\images_all</span></span>
<span class="line"><span style="color: #98C379">    :param labels_dir: D:\Yzmtrain\yzmdata\dyclick_524\labels_all</span></span>
<span class="line"><span style="color: #98C379">    :param img_suffix:</span></span>
<span class="line"><span style="color: #98C379">    :return:</span></span>
<span class="line"><span style="color: #98C379">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    _folder </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">dirname</span><span style="color: #ABB2BF">(image_dir)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> dirs </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> [</span><span style="color: #98C379">&#39;train/images&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;train/labels&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;valid/images&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;valid/labels&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;test/images&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;test/labels&#39;</span><span style="color: #ABB2BF">]:</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">try</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">            os.</span><span style="color: #61AFEF">makedirs</span><span style="color: #ABB2BF">(os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(image_dir, dirs))</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">except</span><span style="color: #ABB2BF"> FileExistsError:</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&#39;</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">dirs</span><span style="color: #D19A66">}</span><span style="color: #98C379"> 目录已存在&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    image_file_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(image_dir)</span></span>
<span class="line"><span style="color: #ABB2BF">    total_num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">len</span><span style="color: #ABB2BF">(image_file_list)</span></span>
<span class="line"><span style="color: #ABB2BF">    train_num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">((total_num</span><span style="color: #56B6C2">-</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">)</span><span style="color: #56B6C2">/</span><span style="color: #D19A66">7</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    valid_num </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> total_num </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">10</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">-</span><span style="color: #ABB2BF"> train_num</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> img_name </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> image_file_list[:</span><span style="color: #D19A66">10</span><span style="color: #ABB2BF">]:</span></span>
<span class="line"><span style="color: #ABB2BF">        json_name </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> img_name.</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(img_suffix, </span><span style="color: #98C379">&quot;.json&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        img_src </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(image_dir, img_name)</span></span>
<span class="line"><span style="color: #ABB2BF">        dst_images </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">_folder</span><span style="color: #D19A66">}</span><span style="color: #98C379">/test/images&quot;</span><span style="color: #ABB2BF">, img_name)</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">rename</span><span style="color: #ABB2BF">(img_src, dst_images)</span></span>
<span class="line"><span style="color: #ABB2BF">        labels_src </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(labels_dir, json_name)</span></span>
<span class="line"><span style="color: #ABB2BF">        dst_labels </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">_folder</span><span style="color: #D19A66">}</span><span style="color: #98C379">/test/labels&quot;</span><span style="color: #ABB2BF">, json_name)</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">rename</span><span style="color: #ABB2BF">(labels_src, dst_labels)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">rename_file</span><span style="color: #ABB2BF">():</span></span>
<span class="line"><span style="color: #ABB2BF">    aa_all </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {}</span></span>
<span class="line"><span style="color: #ABB2BF">    json_folder </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;D:\Yzmtrain\yzmdata\hanzi_1\hanzi\hanzi\js11&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    file_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(json_folder)</span></span>
<span class="line"><span style="color: #ABB2BF">    json_file_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [x </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> x </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> file_list </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;.json&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> x]  </span><span style="color: #7F848E; font-style: italic"># 获取所有json文件的路径</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> p </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> json_file_list:</span></span>
<span class="line"><span style="color: #ABB2BF">        json_file </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(json_folder, p)</span></span>
<span class="line"><span style="color: #ABB2BF">        image_file </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> json_file.</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;\js11&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;json&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;jpg&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(json_file, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;utf-8&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> f:</span></span>
<span class="line"><span style="color: #ABB2BF">            data </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> json.</span><span style="color: #61AFEF">loads</span><span style="color: #ABB2BF">(f.</span><span style="color: #61AFEF">read</span><span style="color: #ABB2BF">())</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(json_file, image_file)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(p, data[</span><span style="color: #98C379">&#39;shapes&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">])</span></span>
<span class="line"><span style="color: #ABB2BF">        aa_all[p] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">data[</span><span style="color: #98C379">&#39;shapes&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #D19A66">}</span><span style="color: #98C379">_</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">p[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">:]</span><span style="color: #D19A66">}</span><span style="color: #98C379">&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">rename</span><span style="color: #ABB2BF">(json_file, </span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;D:\Yzmtrain\yzmdata\hanzi_1\hanzi\hanzi\js11</span><span style="color: #56B6C2">\\</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">data[</span><span style="color: #98C379">&#39;shapes&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #D19A66">}</span><span style="color: #98C379">_</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">p[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">:]</span><span style="color: #D19A66">}</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">rename</span><span style="color: #ABB2BF">(image_file, </span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;D:\Yzmtrain\yzmdata\hanzi_1\hanzi\hanzi</span><span style="color: #56B6C2">\\</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">data[</span><span style="color: #98C379">&#39;shapes&#39;</span><span style="color: #ABB2BF">][</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&#39;label&#39;</span><span style="color: #ABB2BF">]</span><span style="color: #D19A66">}</span><span style="color: #98C379">_</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">p[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">:]</span><span style="color: #D19A66">}</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;json&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&quot;jpg&quot;</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(aa_all)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># rename_file()</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># _folder = &quot;D:\Yzmtrain\yzmdata\chinese&quot;</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># file_list = os.listdir(_folder)</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># json_file_list = [x for x in file_list if &quot;.json&quot; in x]  # 获取所有json文件的路径</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># for p in json_file_list:</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">#     json_file = os.path.join(_folder, p)</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">#     os.rename(json_file, f&quot;D:\Yzmtrain\yzmdata\chinese_json\\{p}&quot;)</span></span></code></pre></div></div></figure>

<p>运行 split_images_floder 之后本地就会生成 一些文件夹，其中存放着划分的验证机和数据集<br>之后创建一个 font.yaml 的文件 在运行 make_yolo_yaml 就生成了支持 yolov8 训练的配置文件。<br>以上都大功告成之后，我们就可以开始进行训练了</p>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> ultralytics </span><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">YOLO</span></span>
<span class="line"><span style="color: #ABB2BF">model </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">YOLO</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;yolov8n.pt&quot;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># load a pretrained model (recommended for training)</span></span>
<span class="line"><span style="color: #ABB2BF">results </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> model.</span><span style="color: #61AFEF">train</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">data</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;font.yaml&quot;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">epochs</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">200</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">cache</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">True</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">imgsz</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">320</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">batch</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">16</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">workers</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">device</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&#39;cuda&#39;</span><span style="color: #ABB2BF">)</span></span></code></pre></div></div></figure>

<p>之后我们会在当前 runs&#x2F;detect&#x2F;train&#x2F;weights 得到一个 best.pt 文件 这就是我们后面需要识别和切割的模型了<br>我们利用<a target="_blank" rel="noopener" href="https://github.com/bubbliiiing/Siamese-pytorch">Siamese-pytorch</a> 我们本地下载 GitHub 中提供的模型，并把它放入 model_data 中，然后我们运行 predict.py 文件 来测试环境是否正确。 如果没问题那么就可以开始我们正式训练了.<br>首先我们来明确一下思路。</p>
<ol>
<li><p>需要先获得一张图片</p>
</li>
<li><p>之后要利用 yolov8 进行识别切割，并保存在一个文件夹中</p>
</li>
<li><p>我们要遍历切割后的文件夹，并且以某一张图片来作为基准，与其他对比。同时获取裁切后的坐标，方便后续找到不同图片时也能得到对应坐标。</p>
<ul>
<li><p>情况 1:对比后找到其他图片为相似度最小的一张</p>
</li>
<li><p>情况 2:当前这张要对比的图片与其他 4 张都不同，是特立独行的图片</p>
<p>4.提交验证，有加密处理加密，有验证提交验证数据包。</p>
</li>
</ul>
</li>
</ol>
<figure class="shiki python"><div class='codeblock'><div class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></div><div class="code"><pre class="shiki one-dark-pro"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> json</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> random</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> time</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> execjs</span></span>
<span class="line"><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">PIL</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> Image</span></span>
<span class="line"><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> ultralytics </span><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">YOLO</span></span>
<span class="line"><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> siamese </span><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> Siamese</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> cv2</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> numpy </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> np</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> os</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">token </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;e7e3456c9521de075c0ed00a7d6d7480&#39;</span></span>
<span class="line"><span style="color: #ABB2BF">headers </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;accept&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;*/*&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;accept-language&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;cache-control&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;no-cache&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;pragma&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;no-cache&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;referer&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;https://sqhd.u.360.cn/&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-ch-ua&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">Not)A;Brand</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">;v=</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">99</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">, </span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">Microsoft Edge</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">;v=</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">127</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">, </span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">Chromium</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">;v=</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">127</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-ch-ua-mobile&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;?0&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-ch-ua-platform&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">Windows</span><span style="color: #56B6C2">\&quot;</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-fetch-dest&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;script&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-fetch-mode&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;no-cors&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;sec-fetch-site&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;same-site&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;user-agent&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36 Edg/127.0.0.0&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #ABB2BF">cookies </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;__huid&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;11xEyO13c+M4dgY6TiYNLPb9LRVgaku/GXVMp/qF0GMNQ=&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;__guid&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;230272478.3358358338768799744.1704856402001.2004&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;__NS_Q&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;u%3Dyv083024%26n%3D</span><span style="color: #D19A66">%26le</span><span style="color: #98C379">%3D%26m%3DZGp3WGWOWGWOWGWOWGWOWGWOZGL4%26qid%3D3403077592</span><span style="color: #D19A66">%26i</span><span style="color: #98C379">m%3D1_t01923d359dad425928</span><span style="color: #D19A66">%26s</span><span style="color: #98C379">rc%3Dpcw_quake%26t%3D1&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;Q&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;u%3Dyv083024%26n%3D</span><span style="color: #D19A66">%26le</span><span style="color: #98C379">%3D%26m%3DZGp3WGWOWGWOWGWOWGWOWGWOZGL4%26qid%3D3403077592</span><span style="color: #D19A66">%26i</span><span style="color: #98C379">m%3D1_t01923d359dad425928</span><span style="color: #D19A66">%26s</span><span style="color: #98C379">rc%3Dpcw_quake%26t%3D1&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;__DC_gid&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;208211024.767422413.1715657472373.1715657472383.2&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;T&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;s%3Dfe966e73df014d7fc952331d9cd492cb%26t%3D1715925046%26lm%3D</span><span style="color: #D19A66">%26lf</span><span style="color: #98C379">%3D4</span><span style="color: #D19A66">%26s</span><span style="color: #98C379">k%3D6d22cff2c2004dc594d8a9cd5674ca07%26mt%3D1715925046</span><span style="color: #D19A66">%26r</span><span style="color: #98C379">c%3D%26v%3D2.0</span><span style="color: #D19A66">%26a</span><span style="color: #98C379">%3D1&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #98C379">&quot;__NS_T&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;s%3Dfe966e73df014d7fc952331d9cd492cb%26t%3D1715925046%26lm%3D</span><span style="color: #D19A66">%26lf</span><span style="color: #98C379">%3D4</span><span style="color: #D19A66">%26s</span><span style="color: #98C379">k%3D6d22cff2c2004dc594d8a9cd5674ca07%26mt%3D1715925046</span><span style="color: #D19A66">%26r</span><span style="color: #98C379">c%3D%26v%3D2.0</span><span style="color: #D19A66">%26a</span><span style="color: #98C379">%3D1&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 获取验证码图片并且保存图片和一些提交验证的参数。</span></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">():</span></span>
<span class="line"><span style="color: #ABB2BF">    url </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;https://captcha.bpd.360.cn/v1/get&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    params </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;appid&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;LS3yVZANuLCqvFn1IWNGVNeC37ExAbuL&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;token&quot;</span><span style="color: #ABB2BF">: token,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;ty&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;3&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    response </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> requests.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(url, </span><span style="color: #E06C75; font-style: italic">headers</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">headers, </span><span style="color: #E06C75; font-style: italic">cookies</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">cookies, </span><span style="color: #E06C75; font-style: italic">params</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">params).</span><span style="color: #61AFEF">json</span><span style="color: #ABB2BF">()</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(response)</span></span>
<span class="line"><span style="color: #ABB2BF">    pic_url </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> response[</span><span style="color: #98C379">&quot;data&quot;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&quot;pic&quot;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&quot;bg&quot;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    ftoken </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> response[</span><span style="color: #98C379">&quot;data&quot;</span><span style="color: #ABB2BF">][</span><span style="color: #98C379">&quot;ftoken&quot;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">    pic_ </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> requests.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(pic_url,</span><span style="color: #E06C75; font-style: italic">headers</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">headers)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">with</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;./img/</span><span style="color: #D19A66">{</span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(time.</span><span style="color: #61AFEF">time</span><span style="color: #ABB2BF">()</span><span style="color: #56B6C2">*</span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">)</span><span style="color: #D19A66">}</span><span style="color: #98C379">.png&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&#39;wb&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> f:</span></span>
<span class="line"><span style="color: #ABB2BF">        f.</span><span style="color: #61AFEF">write</span><span style="color: #ABB2BF">(pic_.content)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;完成&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> pic_url,ftoken</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">pic_url,ftoken </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 加载YOLO模型</span></span>
<span class="line"><span style="color: #ABB2BF">model </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">YOLO</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;best.pt&#39;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 利用YOLO进行 指定坐标裁切</span></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cai_save</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">img_big</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    results </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> model.</span><span style="color: #61AFEF">predict</span><span style="color: #ABB2BF">(img_big)</span></span>
<span class="line"><span style="color: #ABB2BF">    img_big_cai </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> []  </span><span style="color: #7F848E; font-style: italic"># 裁剪图片并保存在列表中</span></span>
<span class="line"><span style="color: #ABB2BF">    center_coordinates </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {}</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> idx, box </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">enumerate</span><span style="color: #ABB2BF">(results[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">].boxes.xyxy):</span></span>
<span class="line"><span style="color: #ABB2BF">        box </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">list</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">map</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">, box))</span></span>
<span class="line"><span style="color: #ABB2BF">        img_c </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> img_big[box[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">]:box[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">], box[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">]:box[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">]]</span></span>
<span class="line"><span style="color: #ABB2BF">        img_big_cai.</span><span style="color: #61AFEF">append</span><span style="color: #ABB2BF">(img_c)</span></span>
<span class="line"><span style="color: #ABB2BF">        center_x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">((box[</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> box[</span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">]) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        center_y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">((box[</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> box[</span><span style="color: #D19A66">3</span><span style="color: #ABB2BF">]) </span><span style="color: #56B6C2">/</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">2</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">#获取裁切后的坐标</span></span>
<span class="line"><span style="color: #ABB2BF">        center_coordinates[</span><span style="color: #C678DD">f</span><span style="color: #98C379">&#39;qie_</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">idx </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1}</span><span style="color: #98C379">&#39;</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span><span style="color: #98C379">&#39;center_x&#39;</span><span style="color: #ABB2BF">: center_x, </span><span style="color: #98C379">&#39;center_y&#39;</span><span style="color: #ABB2BF">: center_y}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 保存裁剪后的图片</span></span>
<span class="line"><span style="color: #ABB2BF">    folder_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;./cai_big_images&#39;</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">exists</span><span style="color: #ABB2BF">(folder_path):</span></span>
<span class="line"><span style="color: #ABB2BF">        os.</span><span style="color: #61AFEF">makedirs</span><span style="color: #ABB2BF">(folder_path)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> idx, img_array </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">enumerate</span><span style="color: #ABB2BF">(img_big_cai, </span><span style="color: #E06C75; font-style: italic">start</span><span style="color: #56B6C2">=</span><span style="color: #D19A66">1</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic"># 生成文件名</span></span>
<span class="line"><span style="color: #ABB2BF">        filename </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;qie_</span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">idx</span><span style="color: #D19A66">}</span><span style="color: #98C379">.jpg&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">        filepath </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(folder_path, filename)</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic"># 保存图片</span></span>
<span class="line"><span style="color: #ABB2BF">        cv2.</span><span style="color: #61AFEF">imwrite</span><span style="color: #ABB2BF">(filepath, img_array)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> center_coordinates</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">dir_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">r</span><span style="color: #E06C75">&#39;E:\Siamese-pytorch</span><span style="color: #56B6C2">\i</span><span style="color: #E06C75">mg&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">files </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(dir_path) </span><span style="color: #7F848E; font-style: italic">#遍历目录下的图片文件</span></span>
<span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(files)</span></span>
<span class="line"><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> files:</span></span>
<span class="line"><span style="color: #ABB2BF">    img </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> cv2.</span><span style="color: #61AFEF">imread</span><span style="color: #ABB2BF">(os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(dir_path, </span><span style="color: #E06C75">file</span><span style="color: #ABB2BF">))</span></span>
<span class="line"><span style="color: #ABB2BF">    center_coordinates </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">cai_save</span><span style="color: #ABB2BF">(img)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(center_coordinates) </span><span style="color: #7F848E; font-style: italic">#输出坐标</span></span>
<span class="line"><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;全部切分完成，开始孪生对比&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic"># 创建一个 Siamese 类的实例</span></span>
<span class="line"><span style="color: #ABB2BF">model </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">Siamese</span><span style="color: #ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">def</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">compare_with_reference</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66; font-style: italic">folder_path</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66; font-style: italic">reference_filename</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">    min_similarity </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">float</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;inf&#39;</span><span style="color: #ABB2BF">)  </span><span style="color: #7F848E; font-style: italic"># 存储与参考图片相比最不相似的图片的相似度</span></span>
<span class="line"><span style="color: #ABB2BF">    unique_image_filename </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">None</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic"># 存储最不相似的图片文件名</span></span>
<span class="line"><span style="color: #ABB2BF">    reference_image </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> Image.</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(folder_path, reference_filename))</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">for</span><span style="color: #ABB2BF"> filename </span><span style="color: #C678DD">in</span><span style="color: #ABB2BF"> os.</span><span style="color: #61AFEF">listdir</span><span style="color: #ABB2BF">(folder_path):</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> filename.</span><span style="color: #61AFEF">endswith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;.jpg&quot;</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">or</span><span style="color: #ABB2BF"> filename.</span><span style="color: #61AFEF">endswith</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;.jpeg&quot;</span><span style="color: #ABB2BF">):</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> filename </span><span style="color: #56B6C2">==</span><span style="color: #ABB2BF"> reference_filename:</span></span>
<span class="line"><span style="color: #ABB2BF">                </span><span style="color: #C678DD">continue</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic"># 跳过参考图片本身</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># 加载图片</span></span>
<span class="line"><span style="color: #ABB2BF">            image_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> os.path.</span><span style="color: #61AFEF">join</span><span style="color: #ABB2BF">(folder_path, filename)</span></span>
<span class="line"><span style="color: #ABB2BF">            image </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> Image.</span><span style="color: #61AFEF">open</span><span style="color: #ABB2BF">(image_path)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># 使用模型计算相似度概率 孪生识别</span></span>
<span class="line"><span style="color: #ABB2BF">            probability </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> model.</span><span style="color: #61AFEF">detect_image</span><span style="color: #ABB2BF">(reference_image, image)</span></span>
<span class="line"><span style="color: #ABB2BF">            probability_value </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> probability.</span><span style="color: #61AFEF">item</span><span style="color: #ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #7F848E; font-style: italic"># 如果当前图片的相似度低于之前记录的最低相似度，则更新</span></span>
<span class="line"><span style="color: #ABB2BF">            </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> probability_value </span><span style="color: #56B6C2">&lt;</span><span style="color: #ABB2BF"> min_similarity:</span></span>
<span class="line"><span style="color: #ABB2BF">                min_similarity </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> probability_value</span></span>
<span class="line"><span style="color: #ABB2BF">                unique_image_filename </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> filename</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 返回最不相似的图片文件名及其相似度</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> unique_image_filename, min_similarity</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">folder_path </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">r</span><span style="color: #E06C75">&quot;E:\Siamese-pytorch</span><span style="color: #56B6C2">\c</span><span style="color: #E06C75">ai_big_images&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #7F848E; font-style: italic">#裁切后图片位置</span></span>
<span class="line"><span style="color: #ABB2BF">unique_image_filename, min_similarity </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">compare_with_reference</span><span style="color: #ABB2BF">(folder_path, </span><span style="color: #98C379">&#39;qie_2.jpg&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #7F848E; font-style: italic">#打开参考图片 qie_2.jpg</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> unique_image_filename </span><span style="color: #C678DD">is</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">not</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">None</span><span style="color: #ABB2BF">:</span></span>
<span class="line"><span style="color: #ABB2BF">    unique_image_key </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> unique_image_filename.</span><span style="color: #61AFEF">replace</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&quot;.jpg&quot;</span><span style="color: #ABB2BF">,</span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    unique_image_coordinates </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> center_coordinates.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(unique_image_key,</span><span style="color: #D19A66">None</span><span style="color: #ABB2BF">)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #C678DD">f</span><span style="color: #98C379">&quot;特立独行的图片是 </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">unique_image_filename</span><span style="color: #D19A66">}</span><span style="color: #98C379">，相似度为 </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">min_similarity</span><span style="color: #D19A66">}</span><span style="color: #98C379">,中心坐标为: </span><span style="color: #D19A66">{</span><span style="color: #ABB2BF">unique_image_coordinates</span><span style="color: #D19A66">}</span><span style="color: #98C379">&quot;</span><span style="color: #ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># # 显示特立独行的图片</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># unique_image_path = os.path.join(folder_path, unique_image_filename)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># unique_image = cv2.imread(unique_image_path)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># cv2.imshow(&#39;Unique Image&#39;, unique_image)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># cv2.waitKey(0)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># cv2.destroyAllWindows()</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(unique_image_coordinates)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">#####网站加密的轨迹坐标处理</span></span>
<span class="line"><span style="color: #ABB2BF">    x </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> unique_image_coordinates[</span><span style="color: #98C379">&#39;center_x&#39;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">    y </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> unique_image_coordinates[</span><span style="color: #98C379">&#39;center_y&#39;</span><span style="color: #ABB2BF">]</span></span>
<span class="line"><span style="color: #ABB2BF">    final_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> []</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;x&#39;</span><span style="color: #ABB2BF">, x)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;y&#39;</span><span style="color: #ABB2BF">, y)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># 网页实际缩放了图片 比例是1/2 所以要乘0.5 对应网页</span></span>
<span class="line"><span style="color: #ABB2BF">    entry </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;x&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(x </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;y&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(y </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">0.5</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;t&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #56B6C2">int</span><span style="color: #ABB2BF">(time.</span><span style="color: #61AFEF">time</span><span style="color: #ABB2BF">() </span><span style="color: #56B6C2">*</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">1000</span><span style="color: #ABB2BF">) </span><span style="color: #56B6C2">+</span><span style="color: #ABB2BF"> random.</span><span style="color: #61AFEF">randint</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">0</span><span style="color: #ABB2BF">, </span><span style="color: #D19A66">150</span><span style="color: #ABB2BF">),  </span><span style="color: #7F848E; font-style: italic"># 固定时间戳</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;type&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;mousedown&quot;</span><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic"># 固定操作类型</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    final_list </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> [entry]</span></span>
<span class="line"><span style="color: #ABB2BF">    guiji </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> json.</span><span style="color: #61AFEF">dumps</span><span style="color: #ABB2BF">(final_list)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(guiji)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic"># aes加密</span></span>
<span class="line"><span style="color: #ABB2BF">    d </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> execjs.</span><span style="color: #61AFEF">compile</span><span style="color: #ABB2BF">(</span><span style="color: #56B6C2">open</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;./1.js&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #98C379">&#39;r&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">encoding</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;utf-8&quot;</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">read</span><span style="color: #ABB2BF">()).</span><span style="color: #61AFEF">call</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;get_d&#39;</span><span style="color: #ABB2BF">, guiji)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(d)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">#提交验证</span></span>
<span class="line"><span style="color: #ABB2BF">    url </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&quot;https://captcha.bpd.360.cn/v1/verify&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">    params </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;appid&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;LS3yVZANuLCqvFn1IWNGVNeC37ExAbuL&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;token&quot;</span><span style="color: #ABB2BF">: token,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;ftoken&quot;</span><span style="color: #ABB2BF">: ftoken,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;d&quot;</span><span style="color: #ABB2BF">: d,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;scale&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;0.5&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;ty&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;3&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;src&quot;</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&quot;&quot;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #98C379">&quot;imgUrl&quot;</span><span style="color: #ABB2BF">: pic_url,</span></span>
<span class="line"><span style="color: #ABB2BF">    }</span></span>
<span class="line"><span style="color: #ABB2BF">    response </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> requests.</span><span style="color: #61AFEF">get</span><span style="color: #ABB2BF">(url, </span><span style="color: #E06C75; font-style: italic">headers</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">headers, </span><span style="color: #E06C75; font-style: italic">cookies</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">cookies, </span><span style="color: #E06C75; font-style: italic">params</span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF">params)</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #56B6C2">print</span><span style="color: #ABB2BF">(response.text)</span></span></code></pre></div></div></figure>

<h4 id="结果验证"><a href="#结果验证" class="headerlink" title="结果验证"></a>结果验证</h4><p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109309098-3d76ce04-5cdd-4b9b-9cfc-6c659a5b58ec.png" alt="image.png" data-caption="image.png" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109335692-96b94096-5360-4bcb-8dc2-1f3b53404403.png" alt="image.png" data-caption="image.png" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://cdn.nlark.com/yuque/0/2024/png/32587696/1723109405751-47dd734f-2a83-487a-9467-61aa33386913.png" alt="image.png" data-caption="image.png" loading="lazy"><br>到此完结。 通过了还是可以的</p>

    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>skuukzky<br>
        <strong>本文链接：</strong><a href="https://lpy30m.github.io/skuukzky.github.io/2024/08/24/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB/" title="https:&#x2F;&#x2F;lpy30m.github.io&#x2F;skuukzky.github.io&#x2F;2024&#x2F;08&#x2F;24&#x2F;%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB&#x2F;%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB&#x2F;" target="_blank" rel="noopener">https:&#x2F;&#x2F;lpy30m.github.io&#x2F;skuukzky.github.io&#x2F;2024&#x2F;08&#x2F;24&#x2F;%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB&#x2F;%E9%AA%8C%E8%AF%81%E7%A0%81%E8%AF%86%E5%88%AB&#x2F;</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
</div>
  
  
    <script async src="/skuukzky.github.io/js/copy-codeblock.js?v=1745648493351"></script>
  

  
      <div class="nexmoe-post-footer">
          <script src="https://giscus.app/client.js"
    data-repo="lpy30m/skuukzky.github.io"
    data-repo-id="R_kgDOMnIPZw"
    data-category="General"
    data-category-id="DIC_kwDOMnIPZ84Ch3f5"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="zh-CN"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

      </div>
  
</div></div><div class="nexmoe-post-right">    <div class="nexmoe-fixed">
        <div class="nexmoe-tool">

            

            
            
            <button class="mdui-fab catalog" style="overflow:unset;">
                <i class="nexmoefont icon-i-catalog"></i>
                <div class="nexmoe-toc">
                    <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#360-%E7%82%B9%E9%80%89%E5%AE%9E%E6%88%98-yolvo8-%E5%AD%AA%E7%94%9F"><span class="toc-number">1.</span> <span class="toc-text">360 点选实战(yolvo8+孪生)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">1.2.</span> <span class="toc-text">结果验证</span></a></li></ol></li></ol>
                </div>
            </button>
            

            

            <a href="#nexmoe-content" class="backtop toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
        </div>
    </div>
</div></div><div id="nexmoe-footer"><!--!--></div><div id="nexmoe-search-space"><div class="search-container"><div class="search-header"><div class="search-input-container"><input class="search-input" type="text" placeholder="搜索" onInput="sinput();"></div><a class="search-close" onclick="sclose();">×</a></div><div class="search-body"></div></div></div><div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2058306854838448" crossorigin="anonymous"></script>
</div><!-- hexo injector body_end start -->
  <script>
  const CODE_CONFIG = {
    beautify: false,
    highlightCopy: true,
    highlightLang: false,
    highlightHeightLimit: 360,
    isHighlightShrink: false,
    copy: {
      success: 'Copy Success',
      error: 'Copy Error',
      noSupport: 'Browser Not Support',
    }
  };
  console.log(
    `%c hexo-shiki-plugin %c v1.0.27 %c https://github.com/nova1751/hexo-shiki-plugin`,
    "color: #fff; background: #5f5f5f",
    "color: #fff; background: #80c8f8",
    ""
  );
  </script>
  <!-- hexo injector body_end end --></body></html>